<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë””ëª¨ ìƒìƒ ë†€ì´í„°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- í°íŠ¸ -->
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

  <style>
    :root{
      --main:#5cab6d; --accent:#a5e6b8; --bg:#f8fff9; --text:#173322;
      --shadow:0 12px 40px rgba(0,0,0,.16);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:'Jua',sans-serif;background:var(--bg);color:var(--text)}
    .screen{display:none}.screen.active{display:block}

    /* ë²„íŠ¼ */
    .btn{border:none;border-radius:28px;padding:14px 28px;font-size:18px;font-weight:800;cursor:pointer;white-space:nowrap;min-width:220px}
    .btn-primary{background:linear-gradient(90deg,#7bd49a,#4aa06b);color:#fff;box-shadow:0 8px 18px rgba(0,0,0,.12)}
    .btn-primary:hover{filter:brightness(1.05);transform:translateY(-1px)}

    /* ì¸íŠ¸ë¡œ */
    .intro{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:20px;text-align:center;
      background:linear-gradient(180deg,#f8fff9 0%, #e9fdee 100%)}
    .intro-top{margin:0;color:#2c7a4c;font-size:18px;opacity:.9}
    .intro-main{margin:0;font-size:46px;line-height:1.1;
      background:linear-gradient(90deg,#A5E6B8,#A9D6FF,#FFD6E8,#FFEAA7,#A5E6B8);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-size:300% 100%;animation:shine 6s linear infinite}
    @media (max-width:480px){ .intro-main{font-size:38px} .intro-top{font-size:16px}}
    @keyframes shine{0%{background-position:0%}100%{background-position:100%}}
    video{width:780px;max-width:100%;border-radius:18px;box-shadow:var(--shadow)}
    .intro-logo img{width:200px;max-width:70vw;margin-top:8px;opacity:0;animation:fadeInUp 1.1s ease-out forwards, glow 4s ease-in-out infinite 1.1s}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    @keyframes glow{0%,100%{filter:brightness(1)}50%{filter:brightness(1.35)}}

    /* í¼ */
    .wrap{max-width:740px;margin:0 auto;padding:16px}
    form{background:#fff;border:3px solid var(--accent);border-radius:20px;padding:22px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
    .form-group{margin-bottom:18px}
    label{display:block;margin-bottom:8px;color:#1e3e2d;font-weight:900}
    input,select,textarea{width:100%;font-family:'Jua',sans-serif;font-size:16px;border:2px solid #d3f2db;border-radius:12px;padding:12px;background:#fff;transition:border .15s, box-shadow .15s}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--main);box-shadow:0 0 0 3px rgba(92,171,109,.18)}
    textarea{min-height:110px;resize:vertical}

    /* ë””ëª¨ ìŠ¤íƒ€ì¼ ê²Œì´ì§€ */
    .gauge{margin-top:8px;background:#eef6ef;border-radius:12px;height:18px;overflow:hidden;position:relative;box-shadow:inset 0 2px 4px rgba(0,0,0,.06)}
    .gauge-bar{height:100%;width:0%;background:#b7e3c7;transition:width .35s ease, background .35s ease;position:relative}
    .gauge-gloss{content:"";position:absolute;inset:0;pointer-events:none;background:linear-gradient(180deg,rgba(255,255,255,.55),rgba(255,255,255,0));mix-blend-mode:screen}
    .sparkle{position:absolute;top:50%;transform:translateY(-50%);width:26px;height:26px;border-radius:50%;
      background:radial-gradient(circle,#fff 0 25%,rgba(255,255,255,.0) 60%);opacity:.0;animation:spark 2.4s ease-in-out infinite}
    .sparkle.r{right:6px}.sparkle.l{left:6px;animation-delay:1.2s}
    @keyframes spark{0%,100%{opacity:.0;transform:translateY(-50%) scale(.6)}50%{opacity:.65;transform:translateY(-50%) scale(1)}}
    .gmsg{margin-top:8px;font-size:16px;color:#2d4d38;min-height:1.6em}

    /* ê²°ê³¼ ì¹´ë“œ */
    .card{position:relative;background:#fff;border:3px solid var(--accent);border-radius:20px;padding:20px 20px 64px;
      max-width:740px;margin:0 auto;box-shadow:0 10px 22px rgba(0,0,0,.12);overflow:hidden}
    .banner{margin:0 0 12px;text-align:center;color:#2d4d38;font-size:26px}
    .card-body{display:grid;grid-template-columns:auto 1fr;gap:14px;align-items:flex-start}
    .dimo{width:clamp(108px,26vw,160px);border-radius:16px;display:none}
    .ratings{display:grid;gap:10px}
    .rating{display:flex;flex-direction:column;gap:6px;background:#f9fffb;border:2px solid #d3f2db;border-radius:10px;padding:10px 12px}
    .rating h3{margin:0;font-size:16px;color:#2d4d38}
    .stars{font-size:24px;line-height:1;color:#ffcc00;text-shadow:0 0 6px rgba(255,204,0,.6);white-space:nowrap}
    .info{margin-top:10px;padding:10px 12px;border-radius:12px;border:2px solid #d3f2db;background:#fafffa;text-align:center;font-size:16px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .info strong{color:var(--main)}
    .footer-logo{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;opacity:.6;font-size:14px;letter-spacing:1px}

    /* ìŠ¤íƒ¬í”„ */
    #stampArea{position:absolute;inset:0;pointer-events:none}
    .stamp-wrap{position:absolute}
    .stamp-img{width:100%;display:block;filter:drop-shadow(0 6px 12px rgba(0,0,0,.1))}
    .stamp-enter{animation:pop .52s cubic-bezier(.18,1.4,.22,1) forwards}
    @keyframes pop{0%{opacity:0;transform:translateY(-14px) scale(1.3) rotate(var(--r,-4deg))}
      65%{opacity:1;transform:translateY(0) scale(.98) rotate(var(--r,-4deg))}
      100%{transform:scale(1) rotate(var(--r,-4deg))}}

    /* ì €ì¥ */
    .center{text-align:center;margin-top:14px}
    .btn-save{background:linear-gradient(135deg,#bff3c8,#8de0d3);color:#0f3a30;font-weight:900}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#2c7a4c;color:#fff;padding:12px 16px;border-radius:10px;
      font-weight:800;box-shadow:0 10px 20px rgba(0,0,0,.18);opacity:0;visibility:hidden;transition:.25s;z-index:9999}
    .toast.show{opacity:1;visibility:visible}

    @media (max-width:480px){
      .card-body{grid-template-columns:1fr}
    }
  </style>
</head>
<body>

  <!-- ì¸íŠ¸ë¡œ -->
  <section id="intro" class="screen active">
    <div class="intro">
      <!-- ìœ„: ì‘ê²Œ / ì•„ë˜: í¬ê²Œ(ë°˜ì§ íš¨ê³¼) -->
      <h2 class="intro-top">ë””ëª¨ì™€ í•¨ê»˜ í•˜ëŠ”</h2>
      <h1 class="intro-main">ìƒìƒ ë†€ì´í„°</h1>

      <video autoplay muted loop playsinline webkit-playsinline>
        <!-- ë™ì˜ìƒ: dimo.mp4 -->
        <source src="dimo.mp4" type="video/mp4">
      </video>

      <button id="toForm" class="btn btn-primary">â–¶ ë””ëª¨ ë§Œë‚˜ëŸ¬ ê°€ê¸°</button>
      <div class="intro-logo"><img src="dimo_logo.png" alt="DIMO UNIVERSE ë¡œê³ "></div>

      <!-- ì¸ì‚¬ ìŒì„± (ëœë¤) -->
      <audio id="intro1" src="ë””ëª¨ì¸íŠ¸ë¡œì¸ì‚¬1.mp3" preload="auto"></audio>
      <audio id="intro2" src="ë””ëª¨ì¸íŠ¸ë¡œì¸ì‚¬2.mp3" preload="auto"></audio>
      <audio id="intro3" src="ë””ëª¨ì¸íŠ¸ë¡œì¸ì‚¬3.mp3" preload="auto"></audio>
      <audio id="intro4" src="ë””ëª¨ì¸íŠ¸ë¡œì¸ì‚¬4.mp3" preload="auto"></audio>
    </div>
  </section>

  <!-- ì„¤ë¬¸ -->
  <section id="formScreen" class="screen">
    <div class="wrap">
      <form id="ideaForm" novalidate>
        <div class="form-group">
          <label>1. ë””ëª¨ëŠ” ì¹œêµ¬ ë‚˜ì´ê°€ ê¶ê¸ˆí•´! *</label>
          <select id="age" required>
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option>8</option><option>9</option><option>10</option><option>11</option><option>12</option>
            <option>13</option><option>14</option><option>15</option><option>16</option><option>17</option><option>18</option><option>19</option>
          </select>
        </div>

        <div class="form-group">
          <label>2. ë„ˆì˜ ë©‹ì§„ ë³„ëª…ì„ ì •í•´ì¤˜! *</label>
          <input id="nickname" type="text" placeholder="ì˜ˆ: ë°œëª…ì™• ë””ëª¨!" required>
        </div>

        <div class="form-group">
          <label>3. 'ì•„~ ì´ê±° ë¶ˆí¸í•˜ë‹¤!' í–ˆë˜ ìˆœê°„ì€? *</label>
          <textarea id="problem" placeholder="ì˜ˆ: ì—°í•„ì´ ìê¾¸ êµ´ëŸ¬ê°€ì„œ ìƒì–´ë²„ë ¤ìš”" required></textarea>
        </div>

        <div class="form-group">
          <label>4. ê·¸ ë¶ˆí¸ì„ í•´ê²°í•  ë©‹ì§„ ë°œëª…í’ˆ ì´ë¦„ì€? *</label>
          <input id="ideaName" type="text" placeholder="ì˜ˆ: ì•ˆ êµ´ëŸ¬ê°€ëŠ” ì—°í•„" required>
        </div>

        <div class="form-group">
          <label>5. ë°œëª…í’ˆì€ ì–´ë–»ê²Œ ì‘ë™í•˜ê³  ë­ê°€ í¸í•´ì ¸? *</label>
          <textarea id="ideaDetail" placeholder="ì˜ˆ: ì—°í•„ì— ì‘ì€ ìì„ì´ ë¶™ì–´ì„œ ì±…ìƒì— ë”± ë¶™ì–´ìš”â€¦" required></textarea>

          <!-- ë””ëª¨ ìŠ¤íƒ€ì¼ ê²Œì´ì§€ -->
          <div class="gauge" aria-hidden="true">
            <div class="gauge-bar" id="charBar"></div>
            <div class="gauge-gloss"></div>
            <div class="sparkle l"></div>
            <div class="sparkle r"></div>
          </div>
          <div id="charMsg" class="gmsg">ğŸŒ± ì•„ì§ ìƒê°ì˜ ì”¨ì•—ì´ì—ìš”</div>
        </div>

        <div class="form-group">
          <label>6. (ì„ íƒ) ë³´í˜¸ì ì´ë©”ì¼</label>
          <input id="parentEmail" type="email" placeholder="ì˜ˆ: parent@example.com" inputmode="email">
        </div>

        <!-- íŒíŠ¸ ìŒì„± (ì²« í´ë¦­ 1íšŒ) -->
        <audio id="hintNickname"   src="ë³„ëª…ì•ˆë‚´ë©˜íŠ¸.mp3" preload="auto"></audio>
        <audio id="hintProblem"    src="ë¶ˆí¸í•œì ì•ˆë‚´ë©˜íŠ¸.mp3" preload="auto"></audio>
        <audio id="hintIdeaDetail" src="ì•„ì´ë””ì–´ì„¤ëª…ë©˜íŠ¸.mp3" preload="auto"></audio>

        <div class="center"><button type="submit" class="btn btn-primary">ë””ëª¨ì—ê²Œ ë³´ë‚´ê¸°</button></div>
      </form>
    </div>
  </section>

  <!-- ê²°ê³¼ -->
  <section id="resultScreen" class="screen">
    <div class="wrap">
      <div id="card" class="card">
        <h2 class="banner">ë‚˜ë§Œì˜ ì•„ì´ë””ì–´ ì¹´ë“œ</h2>
        <div class="card-body">
          <img id="dimoImg" class="dimo" alt="ë””ëª¨" src="">
          <div class="ratings">
            <div class="rating"><h3>ë°˜ì§ì´ëŠ” ìƒìƒë ¥</h3><div id="creativity" class="stars">â˜…â˜…â˜…â˜…â˜…</div></div>
            <div class="rating"><h3>ì •ë§ ë ê¹Œ? ì ìˆ˜</h3><div id="feasibility" class="stars">â˜…â˜…â˜…â˜…â˜…</div></div>
            <div class="rating"><h3>ë””ëª¨ì˜ ê¸°ìˆ ë ¥ ë ˆë²¨</h3><div id="technical" class="stars">â˜…â˜…â˜…â˜…â˜…</div></div>
          </div>
        </div>

        <div class="info">
          <span>ğŸ‘¤ <strong>ë°œëª…ì:</strong> <span id="inventorName"></span></span>
          <span>ğŸ’¡ <strong>ë‚´ ë°œëª…í’ˆ:</strong> <span id="ideaDisplay"></span></span>
        </div>

        <div id="stampArea"></div>
        <div class="footer-logo">DIMO UNIVERSE</div>

        <!-- ê²°ê³¼ í™”ë©´ ì¹­ì°¬ ìŒì„± (ëœë¤ ì¬ìƒìš©) -->
        <audio id="compliment1" src="ë””ëª¨ì¹­ì°¬01.mp3" preload="auto"></audio>
        <audio id="compliment2" src="ë””ëª¨ì¹­ì°¬02.mp3" preload="auto"></audio>
        <audio id="compliment3" src="ë””ëª¨ì¹­ì°¬03.mp3" preload="auto"></audio>
        <audio id="compliment4" src="ë””ëª¨ì¹­ì°¬04.mp3" preload="auto"></audio>
        <audio id="compliment5" src="ë””ëª¨ì¹­ì°¬05.mp3" preload="auto"></audio>
        <audio id="compliment6" src="ë””ëª¨ ì¹­ì°¬ ë©”ì‹œì§€.mp3" preload="auto"></audio>
      </div>

      <div class="center"><button id="saveBtn" class="btn btn-save">ğŸ¨ ì¹´ë“œ ì €ì¥í•˜ê¸°</button></div>
    </div>
  </section>

  <div id="toast" class="toast">ğŸ“¥ ì•¨ë²”ì— ì €ì¥ë˜ì—ˆì–´ìš”!</div>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const MOBILE = matchMedia('(max-width: 480px), (pointer: coarse)').matches;
    const dimoImages = ["dimo01.png","dimo02.png","dimo03.png","dimo04.png"];

    function playOne(a){ if(!a) return Promise.resolve(false);
      try{ a.currentTime=0; a.muted=false; a.volume = Math.min(a.volume||1, 1);
        return a.play().then(()=>true).catch(()=>false);
      }catch(e){ return Promise.resolve(false); }
    }
    async function unlockAudios(ids){
      for(const id of ids){
        const a=document.getElementById(id); if(!a) continue;
        try{ a.load(); const v=a.volume; a.volume=0.001; await a.play(); a.pause(); a.currentTime=0; a.volume=v; }catch(e){}
      }
    }
    function fireConfetti(duration=1500){
      const end = Date.now() + duration;
      (function frame(){
        if(window.confetti){ confetti({particleCount: 6, startVelocity: 32, spread: 360, origin: { x: Math.random(), y: Math.random()*0.4 } }); }
        if(Date.now() < end) requestAnimationFrame(frame);
      })();
    }
    function pickRandomCompliment(){
      const ids=["compliment1","compliment2","compliment3","compliment4","compliment5","compliment6"];
      const els=ids.map(id=>document.getElementById(id)).filter(Boolean);
      return els[Math.floor(Math.random()*els.length)];
    }
    async function playComplimentWithFallback(){
      const a = pickRandomCompliment(); if(!a) return;
      let ok = await playOne(a);
      if(!ok){
        const rs=document.getElementById('resultScreen');
        const handler = async ()=>{ rs.removeEventListener('pointerdown', handler); await playOne(a); };
        rs.addEventListener('pointerdown', handler, {once:true});
      }
    }

    /* ì¸íŠ¸ë¡œ â†’ í¼ */
    (function(){
      const btn=document.getElementById('toForm');
      const intro=document.getElementById('intro');
      const form=document.getElementById('formScreen');
      const intros=["intro1","intro2","intro3","intro4"].map(id=>document.getElementById(id)).filter(Boolean);
      btn.addEventListener('click', async ()=>{
        await unlockAudios(["intro1","intro2","intro3","intro4","hintNickname","hintProblem","hintIdeaDetail"]);
        const pick=a=>a[Math.floor(Math.random()*a.length)];
        const audio=intros.length?pick(intros):null;
        const go=()=>{ intro.classList.remove('active'); form.classList.add('active'); document.getElementById('ideaDetail').focus(); };
        if(!audio){ setTimeout(go,600); return; }
        try{ const p=audio.play(); if(p&&p.then){ p.then(()=>audio.onended=()=>setTimeout(go,400)).catch(()=>setTimeout(go,700)); } else { audio.onended=()=>setTimeout(go,400); } }
        catch{ setTimeout(go,700); }
      }, {passive:true});
    })();

    /* íŒíŠ¸ ìŒì„± 1íšŒ */
    (function(){
      const once={once:true,passive:true};
      document.getElementById('nickname').addEventListener('click',()=>playOne(document.getElementById('hintNickname')),once);
      document.getElementById('problem').addEventListener('click',()=>playOne(document.getElementById('hintProblem')),once);
      document.getElementById('ideaDetail').addEventListener('click',()=>playOne(document.getElementById('hintIdeaDetail')),once);
    })();

    /* ê²Œì´ì§€ & ë©”ì‹œì§€ */
    (function(){
      const detail=document.getElementById('ideaDetail');
      const bar=document.getElementById('charBar');
      const msg=document.getElementById('charMsg');

      function update(){
        const len=(detail.value||'').trim().length;
        const pct=Math.min(len/70*100,100);
        bar.style.width=pct+'%';

        if(len<30){ bar.style.background='#cfdad1'; msg.textContent='ğŸŒ± ì•„ì§ ìƒê°ì˜ ì”¨ì•—ì´ì—ìš”'; }
        else if(len<40){ bar.style.background='linear-gradient(90deg,#a8e6c3,#7bd49a)'; msg.textContent='ğŸ‰ ë””ëª¨ ìŠ¤íƒ¬í”„ íšë“!'; }
        else if(len<50){ bar.style.background='linear-gradient(90deg,#8ac7ff,#4f92ff)'; msg.textContent='ğŸ’« ë§Œì  ê°€ëŠ¥ì„± ë„ë‹¬!'; }
        else if(len<70){ bar.style.background='linear-gradient(90deg,#a48bff,#6a5acd)'; msg.textContent='ğŸ’ ë ˆì–´ ìŠ¤íƒ¬í”„ ì¶”ì²¨ê¶Œ íšë“!'; }
        else { bar.style.background='linear-gradient(90deg,red,orange,yellow,green,blue,indigo,violet)'; msg.textContent='ğŸŒˆ ë ˆì–´ ìŠ¤íƒ¬í”„ ë‹¹ì²¨ í™•ë¥  2ë°° ê°•í™”!'; }
      }
      detail.addEventListener('input',update,{passive:true}); update();
    })();

    /* ì œì¶œ ì²˜ë¦¬ */
    document.getElementById('ideaForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const age=document.getElementById('age').value;
      const nickname=document.getElementById('nickname').value.trim();
      const problem=document.getElementById('problem').value.trim();
      const ideaName=document.getElementById('ideaName').value.trim();
      const ideaDetail=document.getElementById('ideaDetail').value.trim();
      if(!age||!nickname||!problem||!ideaName||ideaDetail.length<10){
        alert('ëª¨ë“  í•­ëª©ì„ ì±„ì›Œì¤˜! (ì„¤ëª…ì€ 10ì ì´ìƒ)'); return;
      }

      // ê²°ê³¼ í™”ë©´ ì „í™˜
      document.getElementById('formScreen').classList.remove('active');
      document.getElementById('resultScreen').classList.add('active');

      // ë°ì´í„° ë°”ì¸ë”©
      document.getElementById('inventorName').textContent=nickname;
      document.getElementById('ideaDisplay').textContent=ideaName;
      const dimo=document.getElementById('dimoImg');
      dimo.src=dimoImages[Math.floor(Math.random()*dimoImages.length)];
      dimo.style.display='block';

      // ë³„ì  í…ìŠ¤íŠ¸ ì•ˆì • í‘œê¸°
      ['creativity','feasibility','technical'].forEach(id=>{
        const el=document.getElementById(id); el.textContent='â˜…â˜…â˜…â˜…â˜…';
      });

      // ì˜¤ë””ì˜¤ ì–¸ë½(ì œìŠ¤ì²˜ ê¸°ë°˜) + ì¹­ì°¬ ì¤€ë¹„
      await unlockAudios(["compliment1","compliment2","compliment3","compliment4","compliment5","compliment6"]);

      // ìŠ¤íƒ¬í”„ íŒì •ë§Œ ë¨¼ì € ê³„ì‚°
      const len=ideaDetail.length;
      let stampSrc='ë””ëª¨ìŠ¤íƒ¬í”„01.png'; // ê¸°ë³¸(30ìâ†‘)
      if(len>=40 && Math.random()<0.04){
        stampSrc='ë””ëª¨ìŠ¤íƒ¬í”„ë§Œì 02.png';
      }else{
        if(len>=70 && Math.random()<0.06){
          stampSrc='ë””ëª¨ìŠ¤íƒ¬í”„ë ˆì–´03.png';
        }else if(len>=50 && Math.random()<0.03){
          stampSrc='ë””ëª¨ìŠ¤íƒ¬í”„ë ˆì–´03.png';
        }
      }

      // 2ì´ˆ ë’¤ì— ìŠ¤íƒ¬í”„ + í­ì£½ + ì¹­ì°¬ ì¬ìƒ
      setTimeout(async ()=>{
        if(len>=30){
          const card=document.getElementById('card');
          const stampArea=document.getElementById('stampArea');
          const size=132, offset=18;
          const x=card.clientWidth - size - offset, y=offset;
          stampArea.innerHTML = `
            <div class="stamp-wrap" style="left:${x}px;top:${y}px;width:${size}px;height:${size}px;">
              <img src="${stampSrc}" alt="ìŠ¤íƒ¬í”„" class="stamp-img stamp-enter" style="--r:${(Math.random()*8-4).toFixed(1)}deg">
            </div>`;
          if(navigator.vibrate){ try{ navigator.vibrate(25);}catch{} }
        }
        // í­ì£½ & ì¹­ì°¬
        fireConfetti(1800);
        playComplimentWithFallback();
      }, 2000);
    });

    /* ì €ì¥ (ìŠ¤íƒ¬í”„ í¬í•¨ ìº¡ì²˜) */
    (function(){
      const btn=document.getElementById('saveBtn'), toast=document.getElementById('toast');
      function showToast(){ toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),1600); }
      btn.addEventListener('click', ()=>{
        const card=document.getElementById('card');
        const scale=Math.min(MOBILE?1.2:1.5, window.devicePixelRatio||1);
        html2canvas(card,{scale, useCORS:true}).then(canvas=>{
          const link=document.createElement('a');
          link.href=canvas.toDataURL('image/png'); link.download='dimo_card.png';
          if(/iPad|iPhone|iPod/.test(navigator.userAgent)){ const w=window.open(); if(w&&w.document) w.document.write('<img src="'+link.href+'" style="width:100%">'); }
          else link.click();
          showToast();
        }).catch(showToast);
      }, {passive:true});
    })();
  </script>
</body>
</html>
